<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Åä„Åã„Å≠„ÅÆ„Åå„Åè„Åó„ÇÖ„ÅÜ„Ç¢„Éó„É™</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        }
        
        .coin {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            margin: 8px;
            font-size: 16px;
            font-weight: bold;
            color: #000;
            cursor: pointer;
            transition: transform 0.2s;
            position: relative;
            overflow: hidden;
        }
        
        .bill {
            width: 120px;
            height: 60px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            margin: 8px;
            font-size: 16px;
            font-weight: bold;
            color: #000;
            cursor: pointer;
            transition: transform 0.2s;
            position: relative;
            overflow: hidden;
        }
        
        /* iPadÁ¨¨9‰∏ñ‰ª£ÂØæÂøú */
        @media (max-width: 1024px) {
            .coin {
                width: 100px;
                height: 100px;
                margin: 12px;
            }
            
            .bill {
                width: 140px;
                height: 70px;
                margin: 12px;
            }
            
            .nav-item {
                padding: 16px 32px;
                font-size: 14px;
            }
            
            .text-2xl {
                font-size: 1.75rem;
            }
            
            .text-3xl {
                font-size: 2rem;
            }
            
            .text-4xl {
                font-size: 2.5rem;
            }
            
            .p-6 {
                padding: 1.75rem;
            }
            
            .gap-4 {
                gap: 1.25rem;
            }
            
            .gap-8 {
                gap: 2.5rem;
            }
        }
        
        @media (max-width: 768px) {
            .coin {
                width: 90px;
                height: 90px;
                margin: 10px;
            }
            
            .bill {
                width: 130px;
                height: 65px;
                margin: 10px;
            }
            
            .nav-item {
                padding: 14px 24px;
                font-size: 13px;
            }
            
            .flex.space-x-4 {
                gap: 0.75rem;
            }
        }
        
        .coin img, .bill img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: inherit;
        }
        
        .coin:hover, .bill:hover {
            transform: scale(1.1);
        }
        
        .tray {
            background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);
            border: 4px solid #F59E0B;
            border-radius: 16px;
            min-height: 200px;
            position: relative;
        }
        
        .tray.drag-over {
            background: linear-gradient(135deg, #FEF3C7 0%, #FCD34D 100%);
            border-color: #F59E0B;
            transform: scale(1.02);
        }
        
        .nav-item {
            padding: 12px 24px;
            border-radius: 16px;
            font-weight: bold;
            font-size: 13px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .nav-item.active {
            background-color: #8B5CF6;
            color: white;
            box-shadow: 0 4px 8px rgba(139, 92, 246, 0.3);
        }
        
        .nav-item:not(.active) {
            background-color: #F3F4F6;
            color: #374151;
        }
        
        .nav-item:not(.active):hover {
            background-color: #EDE9FE;
            color: #7C3AED;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .bounce-animation {
            animation: bounce 1s infinite;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ -->
        <nav class="bg-white shadow-2xl rounded-b-3xl mb-8">
            <div class="max-w-6xl mx-auto px-4">
                                        <div class="flex flex-col md:flex-row justify-between items-center py-4 gap-4">
                            <div class="text-lg font-bold text-purple-600 text-center md:text-left">
                                ü™ô „Åä„Åã„Å≠„ÅÆ„Åå„Åè„Åó„ÇÖ„ÅÜ„Ç¢„Éó„É™
                            </div>
                            <div class="flex space-x-4 flex-wrap justify-center">
                                <div class="nav-item active" onclick="showMode('conversion')">„Åä„Åã„Å≠„ÅÆ„Åã„Çì„Åï„Çì</div>
                                <div class="nav-item" onclick="showMode('tray')">„Éà„É¨„Éº„É¢„Éº„Éâ</div>
                                <div class="nav-item" onclick="showMode('challenge')">„ÉÅ„É£„É¨„É≥„Ç∏</div>
                            </div>
                        </div>
            </div>
        </nav>

        <main class="container mx-auto px-4">
            <!-- ÊèõÁÆó„É¢„Éº„Éâ -->
            <div id="conversion-mode" class="mode-content">
                <h2 class="text-3xl font-bold text-center mb-8 text-white">„Åä„Åã„Å≠„ÅÆ„Åã„Çì„Åï„Çì„É¢„Éº„Éâ</h2>
                <div class="max-w-4xl mx-auto">
                    <div class="mb-8">
                        <h3 class="text-2xl font-bold text-center mb-4 text-white">„Ç≥„Ç§„É≥„Çí„Åà„Çâ„Çì„Åß„Å≠ÔºÅ</h3>
                        <div class="flex flex-wrap justify-center gap-4" id="coin-selection">
                            <!-- „Ç≥„Ç§„É≥„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô -->
                        </div>
                    </div>
                    <div class="conversion-result bg-white rounded-2xl p-8 shadow-2xl">
                        <h3 class="text-2xl font-bold text-center mb-6 text-gray-800" id="conversion-title">
                            1„Åà„Çì„ÅØ„Åª„Åã„ÅÆ„Ç≥„Ç§„É≥„Åß„Å™„Çì„Åæ„ÅÑ„Å∂„ÇìÔºü
                        </h3>
                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6" id="conversion-results">
                            <!-- ÊèõÁÆóÁµêÊûú„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô -->
                        </div>
                        <div class="mt-8 text-center">
                            <div class="text-xl font-bold text-green-600" id="selected-coin-display">
                                1„Åà„Çì = 1„Åà„Çì
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- „Éà„É¨„Éº„É¢„Éº„Éâ -->
            <div id="tray-mode" class="mode-content hidden">
                <h2 class="text-3xl font-bold text-center mb-8 text-white">„Éà„É¨„Éº„É¢„Éº„Éâ</h2>
                <div class="max-w-6xl mx-auto">
                    <div class="grid grid-cols-1 xl:grid-cols-2 gap-8">
                        <div class="wallet-area">
                            <h3 class="text-2xl font-bold text-center mb-6 text-white">„Åó„Çá„Åò„Åç„Çì</h3>
                            <div class="bg-white rounded-2xl p-6 shadow-2xl">
                                <div class="flex flex-wrap justify-center gap-4" id="wallet-coins">
                                    <!-- ÊâÄÊåÅÈáë„ÅÆ„Ç≥„Ç§„É≥„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô -->
                                </div>
                                <div class="text-center mt-4">
                                    <p class="text-gray-600">„Ç≥„Ç§„É≥„Çí„Éâ„É©„ÉÉ„Ç∞„Åó„Å¶„Éà„É¨„Éº„Å´„Åä„ÅÑ„Å¶„Å≠ÔºÅ</p>
                                </div>
                            </div>
                        </div>
                        <div class="tray-area">
                            <div class="tray-container">
                                <div class="tray p-6" id="tray-drop-zone">
                                    <div class="text-center mb-4">
                                        <h3 class="text-2xl font-bold text-yellow-800">„Éà„É¨„Éº</h3>
                                        <div class="text-3xl font-bold text-green-600 mt-2" id="tray-total">
                                            „Åî„ÅÜ„Åë„ÅÑ: 0„Åà„Çì
                                        </div>
                                    </div>
                                    <div class="coins-area flex flex-wrap justify-center items-center min-h-32" id="tray-coins">
                                        <div class="text-gray-500 text-lg">„Ç≥„Ç§„É≥„Çí„Éâ„É©„ÉÉ„Ç∞„Åó„Å¶„Åì„Åì„Å´„Åä„ÅÑ„Å¶„Å≠ÔºÅ</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-8 text-center">
                        <div class="bg-green-500 text-white rounded-2xl p-6 shadow-2xl inline-block">
                            <h3 class="text-2xl font-bold mb-2">„Åî„ÅÜ„Åë„ÅÑ„Åç„Çì„Åå„Åè</h3>
                            <div class="text-4xl font-bold" id="total-amount">0„Åà„Çì</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- „ÉÅ„É£„É¨„É≥„Ç∏„É¢„Éº„Éâ -->
            <div id="challenge-mode" class="mode-content hidden">
                <h2 class="text-3xl font-bold text-center mb-8 text-white">„ÉÅ„É£„É¨„É≥„Ç∏„É¢„Éº„Éâ</h2>
                <div class="max-w-6xl mx-auto">
                    <div class="challenge-display bg-blue-500 text-white rounded-2xl p-6 shadow-2xl mb-8 text-center">
                        <h3 class="text-2xl font-bold mb-2">„Åä„Å†„ÅÑ</h3>
                        <div class="text-3xl font-bold mb-4" id="challenge-description">315„Åà„Çì„Çí„Å†„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
                        <div class="text-xl">„ÇÇ„Åè„Å≤„Çá„ÅÜ: <span id="target-amount">315</span>„Åà„Çì</div>
                    </div>
                    <div class="grid grid-cols-1 xl:grid-cols-2 gap-8">
                        <div class="wallet-area">
                            <h3 class="text-2xl font-bold text-center mb-6 text-white">„Åó„Çá„Åò„Åç„Çì</h3>
                            <div class="bg-white rounded-2xl p-6 shadow-2xl">
                                <div class="flex flex-wrap justify-center gap-4" id="challenge-wallet-coins">
                                    <!-- „ÉÅ„É£„É¨„É≥„Ç∏Áî®„ÅÆÊâÄÊåÅÈáë„Ç≥„Ç§„É≥ -->
                                </div>
                            </div>
                        </div>
                        <div class="tray-area">
                            <div class="tray-container">
                                <div class="tray p-6" id="challenge-tray-drop-zone">
                                    <div class="text-center mb-4">
                                        <h3 class="text-2xl font-bold text-yellow-800">„Éà„É¨„Éº</h3>
                                        <div class="text-3xl font-bold text-green-600 mt-2" id="challenge-tray-total">
                                            „Åî„ÅÜ„Åë„ÅÑ: 0„Åà„Çì
                                        </div>
                                    </div>
                                    <div class="coins-area flex flex-wrap justify-center items-center min-h-32" id="challenge-tray-coins">
                                        <div class="text-gray-500 text-lg">„Ç≥„Ç§„É≥„Çí„Éâ„É©„ÉÉ„Ç∞„Åó„Å¶„Åì„Åì„Å´„Åä„ÅÑ„Å¶„Å≠ÔºÅ</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-8 text-center">
                        <button onclick="checkAnswer()" class="bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-8 rounded-2xl text-xl mr-4 transition-colors">
                            „Åì„Åü„Åà„ÅÇ„Çè„Åõ
                        </button>
                        <button onclick="nextChallenge()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-4 px-8 rounded-2xl text-xl transition-colors">
                            „Å§„Åé„ÅÆ„ÇÇ„Çì„Å†„ÅÑ
                        </button>
                    </div>
                    <div id="challenge-result" class="mt-8 text-center hidden">
                        <!-- ÁµêÊûúË°®Á§∫„Ç®„É™„Ç¢ -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // „Éá„Éº„ÇøÂÆöÁæ©ÔºàÁ°¨Ë≤®„Å®Á¥ôÂπ£„ÇíÂê´„ÇÄÔºâ
        const coins = [
            { id: '1yen', value: 1, name: '1„Åà„Çì', image: 'src/assets/images/1ÂÜÜÁ°¨Ë≤®.png', type: 'coin' },
            { id: '5yen', value: 5, name: '5„Åà„Çì', image: 'src/assets/images/5ÂÜÜÁ°¨Ë≤®.png', type: 'coin' },
            { id: '10yen', value: 10, name: '10„Åà„Çì', image: 'src/assets/images/10ÂÜÜÁ°¨Ë≤®.png', type: 'coin' },
            { id: '50yen', value: 50, name: '50„Åà„Çì', image: 'src/assets/images/50ÂÜÜÁ°¨Ë≤®.png', type: 'coin' },
            { id: '100yen', value: 100, name: '100„Åà„Çì', image: 'src/assets/images/100ÂÜÜÁ°¨Ë≤®.png', type: 'coin' },
            { id: '500yen', value: 500, name: '500„Åà„Çì', image: 'src/assets/images/500ÂÜÜÁ°¨Ë≤®.png', type: 'coin' },
            { id: '1000yen', value: 1000, name: '1000„Åà„Çì', image: 'src/assets/images/1000ÂÜÜÁ¥ôÂπ£.png', type: 'bill' },
            { id: '5000yen', value: 5000, name: '5000„Åà„Çì', image: 'src/assets/images/5000ÂÜÜÁ¥ôÂπ£.png', type: 'bill' },
            { id: '10000yen', value: 10000, name: '10000„Åà„Çì', image: 'src/assets/images/10000ÂÜÜÁ¥ôÂπ£.png', type: 'bill' }
        ];

        const challenges = [
            { targetAmount: 315, description: '315„Åà„Çì„Çí„Å†„Åó„Å¶„Åè„Å†„Åï„ÅÑ' },
            { targetAmount: 150, description: '150„Åà„Çì„Çí„Å†„Åó„Å¶„Åè„Å†„Åï„ÅÑ' },
            { targetAmount: 250, description: '250„Åà„Çì„Çí„Å†„Åó„Å¶„Åè„Å†„Åï„ÅÑ' },
            { targetAmount: 75, description: '75„Åà„Çì„Çí„Å†„Åó„Å¶„Åè„Å†„Åï„ÅÑ' },
            { targetAmount: 420, description: '420„Åà„Çì„Çí„Å†„Åó„Å¶„Åè„Å†„Åï„ÅÑ' },
            { targetAmount: 180, description: '180„Åà„Çì„Çí„Å†„Åó„Å¶„Åè„Å†„Åï„ÅÑ' },
            { targetAmount: 95, description: '95„Åà„Çì„Çí„Å†„Åó„Å¶„Åè„Å†„Åï„ÅÑ' },
            { targetAmount: 360, description: '360„Åà„Çì„Çí„Å†„Åó„Å¶„Åè„Å†„Åï„ÅÑ' },
            { targetAmount: 1500, description: '1500„Åà„Çì„Çí„Å†„Åó„Å¶„Åè„Å†„Åï„ÅÑ' },
            { targetAmount: 2500, description: '2500„Åà„Çì„Çí„Å†„Åó„Å¶„Åè„Å†„Åï„ÅÑ' },
            { targetAmount: 3500, description: '3500„Åà„Çì„Çí„Å†„Åó„Å¶„Åè„Å†„Åï„ÅÑ' },
            { targetAmount: 7500, description: '7500„Åà„Çì„Çí„Å†„Åó„Å¶„Åè„Å†„Åï„ÅÑ' }
        ];

        // Áä∂ÊÖãÁÆ°ÁêÜ
        let currentMode = 'conversion';
        let selectedCoin = coins[0];
        let trayItems = [];
        let challengeTrayItems = [];
        let currentChallenge = challenges[0];

        // „Ç≥„Ç§„É≥„ÉªÁ¥ôÂπ£Ë¶ÅÁ¥†„Çí‰ΩúÊàêÔºàÁîªÂÉè‰ªò„ÅçÔºâ
        function createMoneyElement(money, onClick = null, className = '', draggable = false) {
            const moneyDiv = document.createElement('div');
            const elementClass = money.type === 'bill' ? 'bill' : 'coin';
            moneyDiv.className = `${elementClass} ${className}`;
            moneyDiv.innerHTML = `
                <img src="${money.image}" alt="${money.name}" title="${money.name} ${money.value}„Åà„Çì">
            `;
            
            if (draggable) {
                moneyDiv.draggable = true;
                moneyDiv.setAttribute('data-coin-id', money.id);
                
                // „Éâ„É©„ÉÉ„Ç∞ÈñãÂßã„Ç§„Éô„É≥„Éà
                moneyDiv.addEventListener('dragstart', function(e) {
                    e.dataTransfer.setData('text/plain', money.id);
                    e.dataTransfer.effectAllowed = 'copy';
                });
            }
            
            if (onClick) {
                moneyDiv.onclick = onClick;
            }
            return moneyDiv;
        }

        // „Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„Éó„Ç§„Éô„É≥„Éà„ÅÆË®≠ÂÆö
        function setupDragAndDrop() {
            // Êó¢Â≠ò„ÅÆ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíÂâäÈô§
            const trayDropZone = document.getElementById('tray-drop-zone');
            const challengeTrayDropZone = document.getElementById('challenge-tray-drop-zone');
            
            if (trayDropZone) {
                // Êó¢Â≠ò„ÅÆ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíÂâäÈô§
                const newTrayDropZone = trayDropZone.cloneNode(true);
                trayDropZone.parentNode.replaceChild(newTrayDropZone, trayDropZone);
                
                // Êñ∞„Åó„ÅÑ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíËøΩÂä†
                newTrayDropZone.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'copy';
                    this.classList.add('drag-over');
                });
                
                newTrayDropZone.addEventListener('dragleave', function(e) {
                    this.classList.remove('drag-over');
                });
                
                newTrayDropZone.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('drag-over');
                    const coinId = e.dataTransfer.getData('text/plain');
                    const coin = coins.find(c => c.id === coinId);
                    if (coin) {
                        addToTray(coin);
                    }
                });
            }

            if (challengeTrayDropZone) {
                // Êó¢Â≠ò„ÅÆ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíÂâäÈô§
                const newChallengeTrayDropZone = challengeTrayDropZone.cloneNode(true);
                challengeTrayDropZone.parentNode.replaceChild(newChallengeTrayDropZone, challengeTrayDropZone);
                
                // Êñ∞„Åó„ÅÑ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíËøΩÂä†
                newChallengeTrayDropZone.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'copy';
                    this.classList.add('drag-over');
                });
                
                newChallengeTrayDropZone.addEventListener('dragleave', function(e) {
                    this.classList.remove('drag-over');
                });
                
                newChallengeTrayDropZone.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('drag-over');
                    const coinId = e.dataTransfer.getData('text/plain');
                    const coin = coins.find(c => c.id === coinId);
                    if (coin) {
                        addToChallengeTray(coin);
                    }
                });
            }
        }

        // „É¢„Éº„ÉâÂàá„ÇäÊõø„Åà
        function showMode(mode) {
            currentMode = mode;
            
            // „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥Êõ¥Êñ∞
            document.querySelectorAll('.nav-item').forEach((item, index) => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // „Ç≥„É≥„ÉÜ„É≥„ÉÑË°®Á§∫Âàá„ÇäÊõø„Åà
            document.querySelectorAll('.mode-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(`${mode}-mode`).classList.remove('hidden');
            
            // „É¢„Éº„ÉâÂà•ÂàùÊúüÂåñ
            if (mode === 'conversion') {
                initConversionMode();
            } else if (mode === 'tray') {
                initTrayMode();
            } else if (mode === 'challenge') {
                initChallengeMode();
            }
            
            // „Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„ÉóË®≠ÂÆö„ÇíÊõ¥Êñ∞
            setTimeout(setupDragAndDrop, 100);
        }

        // ÊèõÁÆó„É¢„Éº„ÉâÂàùÊúüÂåñ
        function initConversionMode() {
            const coinSelection = document.getElementById('coin-selection');
            coinSelection.innerHTML = '';
            
            coins.forEach(coin => {
                const coinElement = createMoneyElement(coin, () => {
                    selectedCoin = coin;
                    updateConversionDisplay();
                });
                coinSelection.appendChild(coinElement);
            });
            
            updateConversionDisplay();
        }

        // ÊèõÁÆóË°®Á§∫Êõ¥Êñ∞
        function updateConversionDisplay() {
            document.getElementById('conversion-title').textContent = `${selectedCoin.name}„ÅØ„Åª„Åã„ÅÆ„Ç≥„Ç§„É≥„Åß„Å™„Çì„Åæ„ÅÑ„Å∂„ÇìÔºü`;
            document.getElementById('selected-coin-display').textContent = `${selectedCoin.name} = ${selectedCoin.value}„Åà„Çì`;
            
            const resultsContainer = document.getElementById('conversion-results');
            resultsContainer.innerHTML = '';
            
            coins.forEach(coin => {
                const resultDiv = document.createElement('div');
                resultDiv.className = `text-center p-4 rounded-lg ${coin.id === selectedCoin.id ? 'bg-yellow-200 border-2 border-yellow-400' : 'bg-gray-100'}`;
                
                const coinElement = createMoneyElement(coin);
                resultDiv.appendChild(coinElement);
                
                const conversionText = document.createElement('div');
                conversionText.className = 'mt-2 text-lg font-bold text-gray-700';
                
                if (selectedCoin.value === coin.value) {
                    conversionText.textContent = '„Åä„Å™„Åò„Åç„Çì„Åå„Åè„Åß„Åô';
                } else if (selectedCoin.value > coin.value) {
                    const count = Math.floor(selectedCoin.value / coin.value);
                    conversionText.textContent = `${count}„Åæ„ÅÑ`;
                } else {
                    const count = Math.floor(coin.value / selectedCoin.value);
                    conversionText.textContent = `${count}„Åæ„ÅÑ`;
                }
                
                resultDiv.appendChild(conversionText);
                resultsContainer.appendChild(resultDiv);
            });
        }

        // „Éà„É¨„Éº„É¢„Éº„ÉâÂàùÊúüÂåñ
        function initTrayMode() {
            trayItems = [];
            updateTrayDisplay();
        }

        // „Éà„É¨„ÉºË°®Á§∫Êõ¥Êñ∞
        function updateTrayDisplay() {
            const walletCoins = document.getElementById('wallet-coins');
            const trayCoins = document.getElementById('tray-coins');
            const totalAmount = document.getElementById('total-amount');
            const trayTotal = document.getElementById('tray-total');
            
            // ÊâÄÊåÅÈáëË°®Á§∫
            walletCoins.innerHTML = '';
            coins.forEach(coin => {
                const coinElement = createMoneyElement(coin, null, '', true);
                walletCoins.appendChild(coinElement);
            });
            
            // „Éà„É¨„ÉºË°®Á§∫
            trayCoins.innerHTML = '';
            if (trayItems.length === 0) {
                trayCoins.innerHTML = '<div class="text-gray-500 text-lg">„Ç≥„Ç§„É≥„Çí„Åì„Åì„Å´„Åä„ÅÑ„Å¶„Å≠ÔºÅ</div>';
            } else {
                trayItems.forEach(item => {
                    const coinElement = createMoneyElement(item.coin, () => removeFromTray(item.id));
                    const container = document.createElement('div');
                    container.className = 'relative';
                    container.appendChild(coinElement);
                    
                    const removeBtn = document.createElement('button');
                    removeBtn.className = 'absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 text-xs font-bold hover:bg-red-600';
                    removeBtn.textContent = '√ó';
                    removeBtn.onclick = () => removeFromTray(item.id);
                    container.appendChild(removeBtn);
                    
                    trayCoins.appendChild(container);
                });
            }
            
            // ÂêàË®àÊõ¥Êñ∞
            const total = trayItems.reduce((sum, item) => sum + item.coin.value, 0);
            totalAmount.textContent = `${total}„Åà„Çì`;
            trayTotal.textContent = `„Åî„ÅÜ„Åë„ÅÑ: ${total}„Åà„Çì`;
        }

        // „Éà„É¨„Éº„Å´ËøΩÂä†
        function addToTray(coin) {
            const newItem = {
                id: `${coin.id}-${Date.now()}`,
                coin: coin
            };
            trayItems.push(newItem);
            updateTrayDisplay();
        }

        // „Éà„É¨„Éº„Åã„ÇâÂâäÈô§
        function removeFromTray(itemId) {
            trayItems = trayItems.filter(item => item.id !== itemId);
            updateTrayDisplay();
        }

        // „ÉÅ„É£„É¨„É≥„Ç∏„É¢„Éº„ÉâÂàùÊúüÂåñ
        function initChallengeMode() {
            challengeTrayItems = [];
            currentChallenge = challenges[Math.floor(Math.random() * challenges.length)];
            updateChallengeDisplay();
        }

        // „ÉÅ„É£„É¨„É≥„Ç∏Ë°®Á§∫Êõ¥Êñ∞
        function updateChallengeDisplay() {
            document.getElementById('challenge-description').textContent = currentChallenge.description;
            document.getElementById('target-amount').textContent = currentChallenge.targetAmount;
            
            const walletCoins = document.getElementById('challenge-wallet-coins');
            const trayCoins = document.getElementById('challenge-tray-coins');
            const trayTotal = document.getElementById('challenge-tray-total');
            
            // ÊâÄÊåÅÈáëË°®Á§∫
            walletCoins.innerHTML = '';
            coins.forEach(coin => {
                const coinElement = createMoneyElement(coin, null, '', true);
                walletCoins.appendChild(coinElement);
            });
            
            // „Éà„É¨„ÉºË°®Á§∫
            trayCoins.innerHTML = '';
            if (challengeTrayItems.length === 0) {
                trayCoins.innerHTML = '<div class="text-gray-500 text-lg">„Ç≥„Ç§„É≥„Çí„Åì„Åì„Å´„Åä„ÅÑ„Å¶„Å≠ÔºÅ</div>';
            } else {
                challengeTrayItems.forEach(item => {
                    const coinElement = createMoneyElement(item.coin, () => removeFromChallengeTray(item.id));
                    const container = document.createElement('div');
                    container.className = 'relative';
                    container.appendChild(coinElement);
                    
                    const removeBtn = document.createElement('button');
                    removeBtn.className = 'absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 text-xs font-bold hover:bg-red-600';
                    removeBtn.textContent = '√ó';
                    removeBtn.onclick = () => removeFromChallengeTray(item.id);
                    container.appendChild(removeBtn);
                    
                    trayCoins.appendChild(container);
                });
            }
            
            // ÂêàË®àÊõ¥Êñ∞
            const total = challengeTrayItems.reduce((sum, item) => sum + item.coin.value, 0);
            trayTotal.textContent = `„Åî„ÅÜ„Åë„ÅÑ: ${total}„Åà„Çì`;
        }

        // „ÉÅ„É£„É¨„É≥„Ç∏„Éà„É¨„Éº„Å´ËøΩÂä†
        function addToChallengeTray(coin) {
            const newItem = {
                id: `${coin.id}-${Date.now()}`,
                coin: coin
            };
            challengeTrayItems.push(newItem);
            updateChallengeDisplay();
        }

        // „ÉÅ„É£„É¨„É≥„Ç∏„Éà„É¨„Éº„Åã„ÇâÂâäÈô§
        function removeFromChallengeTray(itemId) {
            challengeTrayItems = challengeTrayItems.filter(item => item.id !== itemId);
            updateChallengeDisplay();
        }

        // Á≠î„ÅàÂêà„Çè„Åõ
        function checkAnswer() {
            const total = challengeTrayItems.reduce((sum, item) => sum + item.coin.value, 0);
            const isCorrect = total === currentChallenge.targetAmount;
            
            const resultDiv = document.getElementById('challenge-result');
            resultDiv.className = `mt-8 text-center ${isCorrect ? 'bounce-animation' : ''}`;
            resultDiv.innerHTML = `
                <div class="rounded-2xl p-6 shadow-2xl inline-block ${isCorrect ? 'bg-green-500 text-white' : 'bg-red-500 text-white'}">
                    <h3 class="text-2xl font-bold mb-2">
                        ${isCorrect ? 'üéâ „Åõ„ÅÑ„Åã„ÅÑÔºÅ' : 'üòÖ „ÇÇ„ÅÜ„ÅÑ„Å°„Å©„ÉÅ„É£„É¨„É≥„Ç∏„Åó„Å¶„Åø„Çà„ÅÜ'}
                    </h3>
                    <div class="text-xl">
                        „ÅÇ„Å™„Åü„ÅÆ„Åì„Åü„Åà: ${total}„Åà„Çì
                    </div>
                    ${!isCorrect ? `<div class="text-lg mt-2">„Åõ„ÅÑ„Åã„ÅÑ: ${currentChallenge.targetAmount}„Åà„Çì</div>` : ''}
                </div>
            `;
            resultDiv.classList.remove('hidden');
        }

        // Ê¨°„ÅÆÂïèÈ°å
        function nextChallenge() {
            challengeTrayItems = [];
            currentChallenge = challenges[Math.floor(Math.random() * challenges.length)];
            document.getElementById('challenge-result').classList.add('hidden');
            updateChallengeDisplay();
        }

        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            initConversionMode();
            setupDragAndDrop();
        });
    </script>
</body>
</html> 